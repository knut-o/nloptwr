---
name: Linux

on:
  label:
    types:
      - created
      - edited
  push:
    branches: ["mainx", "devx", "devx"]
  pull_request:
    branches: ["mainx", "devx", "devx"]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: RelWithDebInfo

jobs:

  build:
    runs-on: ubuntu-latest

    steps:
      - name: checkout
        uses: actions/checkout@v3

      - name: Install NLOPT
        run: |
          echo "vcpkg install --triplet x64-linux"
          vcpkg install --triplet x64-linux
          # echo "vcpkg install nlopt"
          # vcpkg install nlopt:x64-linux

      - name: Configure CMake
        # Configure CMake in a 'build' subdirectory. `CMAKE_BUILD_TYPE` is only required if you are using a single-configuration generator such as make.
        # See https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html?highlight=cmake_build_type
        run: |
          echo "Configure CMake for nloptwr"
          CMAKE_TOOLCHAIN_FILE=/usr/local/share/vcpkg/scripts/buildsystems/vcpkg.cmake cmake -B ${{github.workspace}}/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}
          echo "Configure CMake completed?"

      - name: Build
        run: |
          echo "Find nlopt.hpp"
          # find / -type f -iname nlopt.hpp 2> /dev/null
          echo "TODO: Build"
          cmake --build ${{github.workspace}}/build --config ${{env.BUILD_TYPE}}

      - name: Test
        run: |
          mkdir -p ${{github.workspace}}/build
          cd       ${{github.workspace}}/build
          ctest -C ${{env.BUILD_TYPE}}

      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y rpm graphviz doxygen
          sudo apt-get install -y rpm graphviz doxygen
          mkdir -p ${{github.workspace}}/build

      - name: Create packages
        run: |
          cd  ${{github.workspace}}/build
          cpack

      - name: List content of package
        run: |
          cd  ${{github.workspace}}/build
          ls -l *.deb
          dpkg -c ./*.deb

      - name: Install package
        run: |
          cd  ${{github.workspace}}/build
          sudo dpkg -i ./*.deb
          echo "dpkg -i ./*.deb completed"

#    - name: Example configure
#      run: |
#        echo "vcpkg install --triplet x64-linux"
#        vcpkg install --triplet x64-linux
#        #  echo "vcpkg install nlopt"
#        #  vcpkg install nlopt
#        echo "-"
#        mkdir -p ${{github.workspace}}/example/build
#        cd       ${{github.workspace}}/example
#        echo "Configure CMake example: pwd=$(pwd)"
#        CMAKE_TOOLCHAIN_FILE=/usr/local/share/vcpkg/scripts/buildsystems/vcpkg.cmake cmake -B ${{github.workspace}}/example/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}
#        echo "Configure CMake completed?"
#    # ---------------------------------------------------------------
#    - name: Example build
#      run: |
#        echo "TODO: Build example"
#        cd            ${{github.workspace}}/example
#        cmake --build ${{github.workspace}}/example/build --config ${{env.BUILD_TYPE}}
#    # ---------------------------------------------------------------
#    - name: Example test
#      run: |
#        mkdir -p ${{github.workspace}}/example/build
#        cd       ${{github.workspace}}/example/build
#        ctest -C ${{env.BUILD_TYPE}}
#        echo " "
#        echo "Example test completed"
#        echo " "
#    # ---------------------------------------------------------------
#
